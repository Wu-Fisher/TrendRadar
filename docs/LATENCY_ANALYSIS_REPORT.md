# TrendRadar 延迟分析报告

> 生成时间: 2026-01-31 09:00
> 分析版本: v5.5.0
> 数据源: 同花顺7x24快讯

---

## 1. 执行摘要

本报告分析了 TrendRadar 自定义爬虫系统从新闻发布到邮件推送的全链路延迟情况。

### 关键指标

| 指标 | 数值 |
|------|------|
| 平均端到端延迟 | **3.1 分钟** |
| 中位数延迟 | **3.0 分钟** |
| 最小延迟 | 1.2 分钟 |
| 最大延迟 | 9.9 分钟 |
| Cron 执行间隔 | 1 分钟 |
| 单次执行耗时 | 2-5 秒 |

---

## 2. 延迟分解

### 2.1 延迟链路图

```
新闻源发布    API 更新     爬取获取      过滤处理      邮件发送
    │            │            │            │            │
    │  ~1-2min   │  ~0-1min   │   ~1sec    │   ~2sec    │
    ├───────────►├───────────►├───────────►├───────────►│
    │            │            │            │            │
    t0          t1           t2           t3          t4
```

### 2.2 各环节延迟详情

| 环节 | 描述 | 延迟范围 | 说明 |
|------|------|----------|------|
| 源网站 → API | 新闻发布到 API 更新 | 1-2 分钟 | 源网站内部延迟，不可控 |
| API → 爬取 | API 更新到被爬取 | 0-1 分钟 | 取决于 cron 时间点 |
| 爬取 → 处理 | 网络请求 + 解析 | ~1 秒 | 包括 GBK 转码 |
| 过滤处理 | 三层关键词匹配 | ~0.1 秒 | 标题+摘要+内容 |
| 邮件发送 | SMTP 连接 + 发送 | 1-2 秒 | 163 → Outlook |

---

## 3. 数据采样分析

### 3.1 样本概况

- **有效样本数**: 79 条
- **总记录数**: 182 条
- **采样时间**: 2026-01-31 03:00 - 09:00 (约 6 小时)

### 3.2 延迟分布

```
延迟区间      条目数    占比      分布
─────────────────────────────────────────────
0-1 分钟        0      0.0%
1-2 分钟        6      7.6%     ███
2-3 分钟       35     44.3%     ██████████████████████
3-4 分钟       27     34.2%     █████████████████
4-5 分钟        4      5.1%     ██
5-10 分钟       7      8.9%     ████
```

**分析**:
- 78.5% 的新闻在 2-4 分钟内被抓取
- 极少数 (8.9%) 超过 5 分钟，可能是源网站批量发布导致

### 3.3 统计指标

| 统计量 | 值 |
|--------|------|
| 平均值 | 184 秒 (3.1 分钟) |
| 中位数 | 177 秒 (3.0 分钟) |
| 标准差 | 104 秒 |
| 最小值 | 72 秒 (1.2 分钟) |
| 最大值 | 593 秒 (9.9 分钟) |

---

## 4. 系统执行分析

### 4.1 Cron 执行统计

```
运行时长: ~6 小时
执行次数: 355 次
成功率: 100%
邮件发送: 54 封
```

### 4.2 单次执行耗时

从日志分析，典型执行时间：

| 场景 | 耗时 |
|------|------|
| 无新增（快速跳过） | 2-3 秒 |
| 有新增（发送邮件） | 3-5 秒 |

### 4.3 执行日志示例

```
08:53:00 - Cron 启动
08:53:01 - 程序开始
08:53:01 - 爬取完成 (100条, 新增2条)
08:53:02 - 过滤完成 (通过25条)
08:53:04 - 邮件发送成功
08:53:05 - 任务结束
───────────────────────
总耗时: 5 秒
```

---

## 5. 过滤效率

### 5.1 过滤统计

| 指标 | 数值 |
|------|------|
| 总抓取条目 | 182 条 |
| 通过过滤 | 65 条 (35.7%) |
| 被过滤 | 117 条 (64.3%) |

### 5.2 过滤标签分布

- **通过**: `✓ 地缘政治/能源` 等关键词组
- **过滤**: `🚫 无匹配关键词`

---

## 6. 瓶颈分析

### 6.1 主要瓶颈

| 排名 | 瓶颈 | 贡献 | 可优化性 |
|------|------|------|----------|
| 1 | 源网站发布延迟 | ~1-2 分钟 | ❌ 不可控 |
| 2 | Cron 间隔等待 | ~0-1 分钟 | ⚠️ 可缩短至 10s |
| 3 | 网络请求 | ~1 秒 | ✅ 可优化 |
| 4 | 邮件发送 | ~2 秒 | ⚠️ 依赖外部服务 |

### 6.2 优化建议

1. **如需更实时** (目标 <1 分钟延迟):
   - 将 Cron 模式改为内置轮询模式
   - 配置 `poll_interval: 10` (10 秒轮询)
   - 预计可将 "API → 爬取" 延迟降至 0-10 秒

2. **当前已达最优**:
   - 考虑到源网站本身有 1-2 分钟延迟
   - 1 分钟 Cron 间隔已足够高效
   - 更高频率轮询对实际延迟改善有限

---

## 7. 数据新鲜度验证

### 7.1 API 实时性测试

```
测试时间: 2026/01/31 03:08:38
API pubDate: 2026/01/31 03:08:06
差值: 32 秒
```

**结论**: API 本身更新延迟约 30 秒，非常实时。

### 7.2 新闻内容延迟

| 新闻发布时间 | 被抓取时间 | 延迟 |
|-------------|-----------|------|
| 08:54 | 08:57:02 | 3 分钟 |
| 08:50 | 08:53:02 | 3 分钟 |
| 08:22 | 08:24:22 | 2 分钟 |
| 08:08 | 08:11:02 | 3 分钟 |

---

## 8. 结论

### 8.1 当前性能评估

| 评估项 | 状态 | 说明 |
|--------|------|------|
| 端到端延迟 | ✅ 良好 | 平均 3.1 分钟 |
| 系统稳定性 | ✅ 优秀 | 100% 成功率 |
| 过滤准确性 | ✅ 正常 | 35.7% 通过率 |
| 邮件推送 | ✅ 可靠 | 54 封/6小时 |

### 8.2 适用场景

- ✅ 财经新闻监控 (分钟级延迟可接受)
- ✅ 热点事件追踪
- ⚠️ 高频交易信号 (需优化至秒级)

### 8.3 后续优化方向

1. 如需秒级延迟，考虑 WebSocket 推送
2. 添加延迟监控告警
3. 优化异步内容获取性能

---

## 附录

### A. 系统配置

```yaml
crawler_custom:
  enabled: true
  poll_interval: 10  # 内置轮询间隔（当前使用 cron）

  sources:
    - id: "ths-realtime"
      name: "同花顺7x24"
      type: "ths"
      enabled: true

  filter:
    enabled: true
    levels: ["title", "summary", "content"]
```

### B. Cron 配置

```bash
# docker/.env
CRON_SCHEDULE=*/1 * * * *  # 每 1 分钟
```

### C. 数据库字段

```sql
CREATE TABLE crawler_raw (
    -- 基本字段
    seq TEXT NOT NULL,
    title TEXT NOT NULL,
    published_at TEXT,
    crawl_time TEXT NOT NULL,

    -- 过滤状态
    filtered_out INTEGER DEFAULT 0,
    matched_keywords TEXT,  -- JSON
    filter_tag TEXT,        -- "✓ 关键词" 或 "🚫 原因"
    filter_time TEXT
);
```
