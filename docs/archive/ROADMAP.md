# StockTrendRadar 开发路线图

> 本文档详细描述项目后续开发方向，从软件工程、AI 应用、财经专业三个维度进行规划。

## 目录

- [当前进展总结](#当前进展总结)
- [一、AI 分析系统扩展](#一ai-分析系统扩展)
- [二、数据源扩展](#二数据源扩展)
- [三、软件工程优化](#三软件工程优化)
- [四、财经专业增强](#四财经专业增强)
- [五、产品化方向](#五产品化方向)
- [优先级排序](#优先级排序)

---

## 当前进展总结

### 已完成功能

| 模块 | 功能 | 状态 |
|------|------|------|
| 数据采集 | 同花顺 TAPP API 爬虫 | ✅ 完成 |
| 数据采集 | RSS/Atom 订阅源 | ✅ 完成 |
| 数据采集 | NewsNow 热榜聚合 | ✅ 完成 |
| 数据处理 | 关键词过滤（正则支持） | ✅ 完成 |
| AI 分析 | SimpleAnalyzer（LiteLLM） | ✅ 完成 |
| AI 分析 | CrewAI 单 Agent 分析器 | ✅ 完成 |
| AI 分析 | CrewAI 多 Agent 分析器 | ✅ 完成 |
| 推送 | 两阶段推送（即时 + AI 增强） | ✅ 完成 |
| 推送 | 多渠道支持（邮件/飞书/钉钉/TG 等） | ✅ 完成 |
| 部署 | Docker 容器化 | ✅ 完成 |
| 部署 | 守护进程模式 | ✅ 完成 |

### 当前激活流程

```
同花顺 TAPP API ──▶ 关键词过滤 ──▶ Phase 1 即时推送
                                  │
                                  ▼
                            CrewAI 分析队列
                                  │
                                  ▼
                           Phase 2 AI 增强推送
```

---

## 一、AI 分析系统扩展

### 1.1 历史信息分析

**目标**：结合历史数据，提供更有深度的分析

#### 功能设计

```
┌─────────────────────────────────────────────────────────────┐
│                    历史信息分析系统                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌─────────────────┐    ┌─────────────────────────────┐    │
│  │   新闻向量库     │    │      相似新闻检索           │    │
│  │  (Embedding)    │◀──│  - 语义相似度匹配           │    │
│  │  - Chroma/FAISS │    │  - 历史相关事件             │    │
│  └─────────────────┘    │  - 市场反应参考             │    │
│                          └─────────────────────────────┘    │
│                                     │                        │
│                                     ▼                        │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                   时序分析                            │   │
│  │  - 同类新闻历史走势                                   │   │
│  │  - 事件发酵周期预测                                   │   │
│  │  - 市场情绪趋势                                       │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

#### 实现要点

- [ ] **向量数据库集成**
  - 使用 Chroma/FAISS 存储新闻 Embedding
  - 支持语义相似度搜索
  - 文件：`trendradar/storage/vector_store.py`

- [ ] **历史对比 Agent**
  ```python
  class HistoryAnalystAgent:
      """历史对比分析 Agent"""
      role = "历史事件分析师"
      goal = "从历史相似事件中寻找市场反应规律"
      tools = [
          VectorSearchTool(),      # 相似新闻检索
          TimeSeriesAnalyzer(),    # 时序分析
          MarketDataFetcher(),     # 历史行情数据
      ]
  ```

- [ ] **分析维度**
  - 相似新闻发布后的股价表现
  - 历史事件的市场情绪演变
  - 同类政策的实施效果

### 1.2 联网信息发散

**目标**：根据新闻内容实时检索补充信息

#### 功能设计

```
新闻输入 ──▶ 实体识别 ──▶ 联网搜索 ──▶ 信息聚合 ──▶ 增强分析
              │              │              │
              ▼              ▼              ▼
         [公司名称]    [相关新闻]    [整合上下文]
         [股票代码]    [财报数据]    [全面分析]
         [行业板块]    [研报观点]
```

#### 实现要点

- [ ] **Web 搜索集成**
  - 集成 SerpAPI / Tavily / Exa 搜索 API
  - 支持多源信息聚合
  - 文件：`trendradar/ai/tools/web_search.py`

- [ ] **实体识别与链接**
  ```python
  class EntityLinker:
      """实体识别与链接"""
      def extract_entities(self, text: str) -> List[Entity]:
          """提取公司名、股票代码、行业等实体"""
          pass

      def link_to_knowledge_base(self, entity: Entity) -> Dict:
          """链接到知识库获取详细信息"""
          pass
  ```

- [ ] **搜索增强 Agent**
  ```python
  class ResearchAgent:
      """联网研究 Agent"""
      role = "财经研究员"
      tools = [
          WebSearchTool(),         # 网页搜索
          NewsAggregatorTool(),    # 新闻聚合
          CompanyInfoTool(),       # 公司信息查询
      ]
  ```

### 1.3 专业数据源接入

**目标**：接入 pywencai 等专业财经数据接口

#### pywencai 集成

```python
# trendradar/data/wencai_client.py
from pywencai import get

class WencaiClient:
    """问财数据客户端"""

    def query_stock_info(self, keyword: str) -> pd.DataFrame:
        """查询股票基本信息"""
        return get(query=f"{keyword}的基本面数据")

    def query_financial_data(self, code: str) -> pd.DataFrame:
        """查询财务数据"""
        return get(query=f"{code}最近3年财务数据")

    def query_news_impact(self, event: str) -> pd.DataFrame:
        """查询事件影响"""
        return get(query=f"{event}受益股")

    def query_industry_chain(self, industry: str) -> pd.DataFrame:
        """查询产业链"""
        return get(query=f"{industry}产业链上下游")
```

#### 数据增强 Agent

```python
class DataEnrichmentAgent:
    """数据增强 Agent"""
    role = "数据分析师"
    tools = [
        WencaiQueryTool(),       # 问财查询
        TuShareDataTool(),       # TuShare 数据
        AkShareDataTool(),       # AkShare 数据
    ]

    def enrich_news(self, news: NewsItem) -> EnrichedNews:
        """
        根据新闻内容自动查询相关数据:
        - 涉及公司的基本面
        - 所属行业的近期表现
        - 相关概念板块
        - 机构持仓变化
        """
        pass
```

#### 支持的数据维度

| 数据类型 | 来源 | 用途 |
|----------|------|------|
| 股票基本面 | pywencai | 公司估值、财务指标 |
| 行业数据 | TuShare | 板块涨跌、资金流向 |
| 机构持仓 | AkShare | 北向资金、主力动向 |
| 研报观点 | 东方财富 | 机构评级、目标价 |

### 1.4 多 Agent 协作优化

**目标**：设计更专业的 Agent 团队

#### Agent 团队设计

```
┌─────────────────────────────────────────────────────────────┐
│                      Agent 团队架构                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │ 新闻解读师  │  │ 行业分析师  │  │   宏观策略师        │ │
│  │ - 信息提取  │  │ - 产业链    │  │   - 政策解读        │ │
│  │ - 事实核查  │  │ - 竞争格局  │  │   - 宏观趋势        │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
│         │                │                   │              │
│         └────────────────┼───────────────────┘              │
│                          ▼                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    投资顾问 (综合)                    │   │
│  │  - 整合各维度分析                                     │   │
│  │  - 生成投资建议                                       │   │
│  │  - 风险提示                                           │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

#### 专业 Agent 定义

```python
# trendradar/ai/agents/specialists.py

INDUSTRY_ANALYST = Agent(
    role="行业分析师",
    goal="深入分析新闻涉及的行业竞争格局和产业链影响",
    backstory="""你是一位资深行业研究员，拥有 10 年 TMT/新能源/医药行业研究经验。
    你擅长从单条新闻中识别行业变革信号，分析对产业链上下游的传导效应。""",
    tools=[WencaiTool(), IndustryChainTool()],
)

MACRO_STRATEGIST = Agent(
    role="宏观策略师",
    goal="从宏观经济和政策角度解读新闻影响",
    backstory="""你是首席宏观策略师，精通货币政策、财政政策对市场的影响。
    你能准确判断政策意图，预判市场反应。""",
    tools=[PolicyDatabaseTool(), MacroDataTool()],
)

QUANTITATIVE_ANALYST = Agent(
    role="量化分析师",
    goal="用数据验证新闻的市场影响",
    backstory="""你是量化研究员，擅长用数据说话。
    你会用历史数据验证类似事件的市场反应，给出概率化的预测。""",
    tools=[BacktestTool(), StatisticalAnalyzer()],
)
```

### 1.5 RAG 增强分析

**目标**：构建财经知识库，增强分析深度

#### 知识库构建

```
┌─────────────────────────────────────────────────────────────┐
│                      RAG 知识库架构                          │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  知识来源                       向量存储                     │
│  ┌─────────────┐              ┌─────────────────┐           │
│  │ 历史研报    │──Embedding──▶│                 │           │
│  │ 政策文件    │              │   Chroma DB     │           │
│  │ 行业百科    │              │   / Pinecone    │           │
│  │ 财经术语    │              │                 │           │
│  └─────────────┘              └─────────────────┘           │
│                                        │                     │
│                                        ▼                     │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    RAG 检索增强                       │   │
│  │  Query: "央行降准对银行股有什么影响？"                │   │
│  │  ──▶ 检索相关文档                                     │   │
│  │  ──▶ 结合上下文生成回答                               │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

#### 实现要点

- [ ] 研报数据库（PDF 解析 + 向量化）
- [ ] 政策数据库（结构化存储 + 关系图谱）
- [ ] 实时知识更新机制
- [ ] LangChain/LlamaIndex RAG 流水线

---

## 二、数据源扩展

### 2.1 实时行情数据

- [ ] **Level-1 行情**
  - TuShare 实时行情
  - AkShare 分时数据
  - 用于新闻发布后的价格反应监控

- [ ] **资金流向**
  - 北向资金实时
  - 主力资金监控
  - 板块资金热度

### 2.2 另类数据源

- [ ] **舆情数据**
  - 雪球帖子情绪
  - 股吧讨论热度
  - 微博财经大 V

- [ ] **卫星数据**（高级）
  - 工厂开工率
  - 港口吞吐量

### 2.3 更多新闻源

- [ ] **券商研报**
  - 东方财富研报
  - 同花顺研报
  - 自动摘要与评级提取

- [ ] **公告解析**
  - 上市公司公告
  - 监管公告
  - 结构化提取关键信息

---

## 三、软件工程优化

### 3.1 架构升级

#### 微服务化

```
┌─────────────────────────────────────────────────────────────┐
│                      微服务架构                              │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │ 爬虫服务    │  │  AI 服务    │  │   推送服务          │ │
│  │ Crawler     │  │  Analyzer   │  │   Notifier          │ │
│  │ Service     │  │  Service    │  │   Service           │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
│         │                │                   │              │
│         └────────────────┼───────────────────┘              │
│                          ▼                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                 消息队列 (Redis/RabbitMQ)             │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

#### 任务实现

- [ ] Redis 消息队列（替代内存队列）
- [ ] 服务健康检查与自动恢复
- [ ] 分布式任务调度
- [ ] API Gateway

### 3.2 可观测性

- [ ] **监控告警**
  - Prometheus 指标收集
  - Grafana 仪表盘
  - 异常告警（爬虫失败、AI 超时等）

- [ ] **日志管理**
  - 结构化日志（JSON 格式）
  - ELK 日志聚合
  - 链路追踪

- [ ] **性能优化**
  - 爬虫并发优化
  - AI 批处理
  - 缓存策略

### 3.3 测试与质量

- [ ] **单元测试**
  - 爬虫解析测试
  - AI 输出格式测试
  - 推送渠道测试

- [ ] **集成测试**
  - 端到端流水线测试
  - Mock AI 响应

- [ ] **CI/CD**
  - GitHub Actions 自动化
  - Docker 镜像自动构建
  - 版本发布管理

### 3.4 配置管理

- [ ] **动态配置**
  - 配置热更新（无需重启）
  - 关键词规则动态加载
  - AI Prompt 在线编辑

- [ ] **多环境支持**
  - 开发/测试/生产环境隔离
  - 配置加密存储

---

## 四、财经专业增强

### 4.1 智能交易信号

**目标**：从新闻分析中提取交易信号

#### 信号生成流程

```
新闻 ──▶ AI 分析 ──▶ 影响评估 ──▶ 信号生成 ──▶ 风控过滤 ──▶ 推送
              │           │            │
              ▼           ▼            ▼
         [情感倾向]  [影响板块]   [信号强度]
         [重要性]    [受益个股]   [持续时间]
```

#### 信号类型

| 信号类型 | 触发条件 | 示例 |
|----------|----------|------|
| 政策利好 | 重大政策发布 | "新能源补贴延续" |
| 业绩预告 | 业绩大幅变动 | "业绩预增 100%" |
| 行业事件 | 行业重大变化 | "芯片产能扩张" |
| 黑天鹅 | 突发负面事件 | "财务造假" |

### 4.2 知识图谱

**目标**：构建财经领域知识图谱

#### 图谱结构

```
┌─────────────────────────────────────────────────────────────┐
│                      财经知识图谱                            │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│     [公司] ───所属行业───▶ [行业]                           │
│       │                       │                              │
│       │ 竞争对手              │ 上下游                       │
│       ▼                       ▼                              │
│     [公司] ◀──────────── [行业]                             │
│       │                       │                              │
│       │ 高管                  │ 政策影响                     │
│       ▼                       ▼                              │
│     [人物] ◀──────────── [政策]                             │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

#### 应用场景

- 新闻实体自动链接
- 关联公司/行业推荐
- 影响传导路径分析

### 4.3 情绪指数

**目标**：构建市场情绪量化指标

- [ ] **新闻情绪指数**
  - 日度/周度情绪评分
  - 行业情绪热力图
  - 情绪趋势预警

- [ ] **舆情指数**
  - 社交媒体情绪
  - 讨论热度变化
  - 情绪极端值检测

### 4.4 回测验证

**目标**：验证新闻信号的有效性

- [ ] **历史回测框架**
  - 新闻发布 → 股价反应
  - 信号胜率统计
  - 策略收益曲线

- [ ] **实时跟踪**
  - 信号发出后价格监控
  - 信号准确率统计
  - 持续优化模型

---

## 五、产品化方向

### 5.1 Web 管理界面

- [ ] **实时监控面板**
  - 爬虫状态监控
  - 新闻流实时展示
  - AI 分析进度

- [ ] **配置管理**
  - 可视化关键词配置
  - Prompt 在线编辑
  - 推送渠道管理

- [ ] **历史查询**
  - 新闻搜索
  - 分析报告查看
  - 数据导出

### 5.2 移动端支持

- [ ] **小程序/APP**
  - 实时推送接收
  - 自选股关联
  - 个性化订阅

### 5.3 API 服务

- [ ] **开放 API**
  - 新闻数据 API
  - AI 分析 API
  - Webhook 集成

---

## 优先级排序

### P0 - 近期（1-2 月）

| 任务 | 模块 | 预期收益 |
|------|------|----------|
| pywencai 数据接入 | 数据源 | 分析深度大幅提升 |
| 历史新闻向量库 | AI | 相似事件对比分析 |
| Web 监控面板 | 产品 | 运维效率提升 |

### P1 - 中期（3-6 月）

| 任务 | 模块 | 预期收益 |
|------|------|----------|
| 联网搜索增强 | AI | 信息完整性提升 |
| 多 Agent 优化 | AI | 分析专业性提升 |
| Redis 消息队列 | 工程 | 系统稳定性提升 |
| 知识图谱 | 财经 | 关联分析能力 |

### P2 - 远期（6 月+）

| 任务 | 模块 | 预期收益 |
|------|------|----------|
| 交易信号生成 | 财经 | 投资辅助决策 |
| 回测验证 | 财经 | 信号有效性验证 |
| 微服务架构 | 工程 | 系统可扩展性 |
| 移动端 | 产品 | 用户触达 |

---

## 参考资源

### AI 框架
- [CrewAI 文档](https://docs.crewai.com/)
- [LangChain 文档](https://python.langchain.com/)
- [LlamaIndex 文档](https://docs.llamaindex.ai/)

### 数据源
- [pywencai](https://github.com/zsrl/pywencai)
- [TuShare](https://tushare.pro/)
- [AkShare](https://akshare.xyz/)

### 向量数据库
- [Chroma](https://www.trychroma.com/)
- [Pinecone](https://www.pinecone.io/)
- [Milvus](https://milvus.io/)
